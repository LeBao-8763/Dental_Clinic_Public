{% extends 'admin/base.html' %}
{% block body %}

<form method="get" class="form-inline mb-4">
  <label for="month" class="mr-2">Th√°ng:</label>
  <input type="number" id="month" name="month" min="1" max="12"
         value="{{ selected_month or '' }}" class="form-control mr-3">

  <label for="dentist_id" class="mr-2">B√°c sƒ©:</label>
  <select id="dentist_id" name="dentist_id" class="form-control mr-3">
    <option value="">-- T·∫•t c·∫£ --</option>
    {% for d in dentists %}
      <option value="{{ d.id }}" {% if selected_dentist == d.id %}selected{% endif %}>
        {d.name}
      </option>
    {% endfor %}
  </select>

  <button type="submit" class="btn btn-primary">L·ªçc</button>
</form>

<canvas id="revenueChart" height="100"></canvas>

<table class="table table-striped mt-4">
  <thead>
    <tr>
      {% if mode == 'dentist' %}
        <th>B√°c sƒ©</th>
      {% else %}
        <th>Ng√†y</th>
      {% endif %}
      <th>Doanh thu (VNƒê)</th>
    </tr>
  </thead>
  <tbody>
    {% for row in data %}
      <tr>
        <td>
          {% if mode == 'dentist' %}
            {{ row.dentist_name }}
          {% else %}
            {{ row.date.strftime('%d/%m/%Y') }}
          {% endif %}
        </td>
        <td>{{ "{:,.0f}".format(row.total_revenue or 0) }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('revenueChart').getContext('2d');
const labels = [
  {% for row in data %}
    {% if mode == 'dentist' %}
      "{{ row.dentist_name }}",
    {% else %}
      "{{ row.date.strftime('%d/%m') }}",
    {% endif %}
  {% endfor %}
];
const dataValues = [
  {% for row in data %}
    {{ row.total_revenue or 0 }},
  {% endfor %}
];
new Chart(ctx, {
  type: 'bar',
  data: {
    labels: labels,
    datasets: [{
      label: 'Doanh thu (VNƒê)',
      data: dataValues,
      backgroundColor: 'rgba(54, 162, 235, 0.6)',
      borderColor: 'rgba(54, 162, 235, 1)',
      borderWidth: 1,

      // üîπ Ch·ªânh chi·ªÅu ngang (ƒë·ªô d√†y c·ªôt) ·ªü ƒë√¢y:
      barPercentage: 0.5,        // 0.1 = r·∫•t m·∫£nh, 1.0 = ƒë·∫ßy h·∫øt kho·∫£ng
      categoryPercentage: 0.7    // ƒëi·ªÅu ch·ªânh kho·∫£ng c√°ch gi·ªØa c√°c c·ªôt
    }]
  },
  options: {
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          callback: function(value) {
            return value.toLocaleString('vi-VN');
          }
        }
      },
      x: {
        ticks: { autoSkip: false } // tr√°nh ·∫©n nh√£n n·∫øu c√≥ nhi·ªÅu label
      }
    }
  }
});

</script>

{% endblock %}
